(function(a){var r=a.fn.domManip,d="_tmplitem",q=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,b={},f={},e,p={key:0,data:{}},h=0,c=0,l=[];function g(e,d,g,i){var c={data:i||(d?d.data:{}),_wrap:d?d._wrap:null,tmpl:null,parent:d||null,nodes:[],calls:u,nest:w,wrap:x,html:v,update:t};e&&a.extend(c,e,{nodes:[],parent:d});if(g){c.tmpl=g;c._ctnt=c._ctnt||c.tmpl(a,c);c.key=++h;(l.length?f:b)[h]=c}return c}a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(f,d){a.fn[f]=function(n){var g=[],i=a(n),k,h,m,l,j=this.length===1&&this[0].parentNode;e=b||{};if(j&&j.nodeType===11&&j.childNodes.length===1&&i.length===1){i[d](this[0]);g=this}else{for(h=0,m=i.length;h<m;h++){c=h;k=(h>0?this.clone(true):this).get();a.fn[d].apply(a(i[h]),k);g=g.concat(k)}c=0;g=this.pushStack(g,f,i.selector)}l=e;e=null;a.tmpl.complete(l);return g}});a.fn.extend({tmpl:function(d,c,b){return a.tmpl(this[0],d,c,b)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(d,l,j){if(d[0]&&d[0].nodeType){var f=a.makeArray(arguments),g=d.length,i=0,h;while(i<g&&!(h=a.data(d[i++],"tmplItem"))){;}if(g>1){f[0]=[a.makeArray(d)];}if(h&&c){f[2]=function(b){a.tmpl.afterManip(this,b,j)};}r.apply(this,f)}else{r.apply(this,arguments);}c=0;!e&&a.tmpl.complete(b);return this}});a.extend({tmpl:function(d,h,e,c){var j,k=!c;if(k){c=p;d=a.template[d]||a.template(null,d);f={}}else if(!d){d=c.tmpl;b[c.key]=c;c.nodes=[];c.wrapped&&n(c,c.wrapped);return a(i(c,null,c.tmpl(a,c)))}if(!d){return[];}if(typeof h==="function"){h=h.call(c||{});}e&&e.wrapped&&n(e,e.wrapped);j=a.isArray(h)?a.map(h,function(a){return a?g(e,c,d,a):null}):[g(e,c,d,h)];return k?a(i(c,null,j)):j},tmplItem:function(b){var c;if(b instanceof a){b=b[0];}while(b&&b.nodeType===1&&!(c=a.data(b,"tmplItem"))&&(b=b.parentNode)){;}return c||p},template:function(c,b){if(b){if(typeof b==="string"){b=o(b);}else if(b instanceof a){b=b[0]||{};}if(b.nodeType){b=a.data(b,"tmpl")||a.data(b,"tmpl",o(b.innerHTML));}return typeof c==="string"?(a.template[c]=b):b}return c?typeof c!=="string"?a.template(null,c):a.template[c]||a.template(null,q.test(c)?c:a(c)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(){b={}},afterManip:function(f,b,d){var e=b.nodeType===11?a.makeArray(b.childNodes):b.nodeType===1?[b]:[];d.call(f,b);m(e);c++}});function i(e,g,f){var b,c=f?a.map(f,function(a){return typeof a==="string"?e.key?a.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+d+'="'+e.key+'" $2'):a:i(a,e,a._ctnt)}):e;if(g){return c;}c=c.join("");c.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(f,c,e,d){b=a(e).get();m(b);if(c){b=j(c).concat(b);}if(d){b=b.concat(j(d))}});return b?b:j(c)}function j(c){var b=document.createElement("div");b.innerHTML=c;return a.makeArray(b.childNodes)}function o(b){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+a.trim(b).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(m,l,j,d,b,c,e){var i=a.tmpl.tag[j],h,f,g;if(!i){throw"Template command not found: "+j;}h=i._default||[];if(c&&!/\w$/.test(b)){b+=c;c=""}if(b){b=k(b);e=e?","+k(e)+")":c?")":"";f=c?b.indexOf(".")>-1?b+c:"("+b+").call($item"+e:b;g=c?f:"(typeof("+b+")==='function'?("+b+").call($item):("+b+"))"}else{g=f=h.$1||"null";}d=k(d);return"');"+i[l?"close":"open"].split("$notnull_1").join(b?"typeof("+b+")!=='undefined' && ("+b+")!=null":"true").split("$1a").join(g).split("$1").join(f).split("$2").join(d?d.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(d,c,b,a){a=a?","+a+")":b?")":"";return a?"("+c+").call($item"+a:d}):h.$2||"")+"_.push('"})+"');}return _;")}function n(c,b){c._wrap=i(c,true,a.isArray(b)?b:[q.test(b)?b:a(b).html()]).join("")}function k(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function s(b){var a=document.createElement("div");a.appendChild(b.cloneNode(true));return a.innerHTML}function m(o){var n="_"+c,k,j,l={},e,p,i;for(e=0,p=o.length;e<p;e++){if((k=o[e]).nodeType!==1){continue;}j=k.getElementsByTagName("*");for(i=j.length-1;i>=0;i--){m(j[i]);}m(k)}function m(j){var p,i=j,k,e,m;if(m=j.getAttribute(d)){while(i.parentNode&&(i=i.parentNode).nodeType===1&&!(p=i.getAttribute(d))){;}if(p!==m){i=i.parentNode?i.nodeType===11?0:i.getAttribute(d)||0:0;if(!(e=b[m])){e=f[m];e=g(e,b[i]||f[i],null,true);e.key=++h;b[h]=e}c&&o(m)}j.removeAttribute(d)}else if(c&&(e=a.data(j,"tmplItem"))){o(e.key);b[e.key]=e;i=a.data(j.parentNode,"tmplItem");i=i?i.key:0}if(e){k=e;while(k&&k.key!=i){k.nodes.push(j);k=k.parent}delete e._ctnt;delete e._wrap;a.data(j,"tmplItem",e)}function o(a){a=a+n;e=l[a]=l[a]||g(e,b[e.parent.key+n]||e.parent,null,true)}}}function u(a,d,c,b){if(!a){return l.pop();}l.push({_:a,tmpl:d,item:this,data:c,options:b})}function w(d,c,b){return a.tmpl(a.template(d),c,b,this)}function x(b,d){var c=b.options||{};c.wrapped=d;return a.tmpl(a.template(b.tmpl),b.data,c,b.item)}function v(d,c){var b=this._wrap;return a.map(a(a.isArray(b)?b.join(""):b).filter(d||"*"),function(a){return c?a.innerText||a.textContent:a.outerHTML||s(a)})}function t(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]);a(b).remove()}})(jQuery);if(!$.Leverate){$.Leverate=new Object();};(function($){if(!$.Leverate){$.Leverate=new Object();};$.Leverate.SocialFeed=function(el,options){var base=this;base.$el=$(el);base.el=el;base.currentItems=0;base.feed=[];base.feedCache=[];base.timestamp=0,base.noItemsRemoved=false,base.noLooping=false,base.loopingItem=0,base.mouseover=false,base.lastItemTimestamp=0;base.$el.data("Leverate.SocialFeed",base);base.init=function(){base.options=$.extend({},$.Leverate.SocialFeed.defaultOptions,options);base.start();base.$el.find(".feed-action").live('click',function(){var data=$(this).parentsUntil(base.$el,base.options.itemSelector).data("feedItem");base.options.copyClick(data);});base.$el.mouseover(function(){base.mouseover=true;});base.$el.mouseout(function(){base.mouseover=false;});base.$el.addClass('social-feed-container').append('<div id="preload-message" class="no-items-to-display"><img alt="" style="vertical-align:-8px;margin-right:5px;" src="'+base.options.socialWidgetClientUrl+'/content/images/website/loader.gif" /> Loading...</div><div class="leverate-feed-sirix-logo"></div>');};base.start=function(){base.fetchNewItems();setInterval(base.checkForNewItems,base.options.addItemInterval);setInterval(base.fetchNewItems,base.options.fetchDataInterval);};base.checkForNewItems=function(){if(base.mouseover){return;}var item=null;if(base.feed.length>0&&!base.noLooping){item=base.feed.pop();base.addFeedItem(item);base.lastItemTimestamp=new Date().getTime();base.feedCache.unshift(item);if(base.feedCache.length>base.options.maxCacheItems){base.feedCache.pop();}}else{var date=new Date().getTime()-base.lastItemTimestamp;if(base.noLooping||(base.feedCache.length>0&&date>base.options.loopWaitTime)){item=base.feedCache.pop();base.addFeedItem(item);base.feedCache.unshift(item);base.noLooping=true;base.loopingItem++;if(base.loopingItem>=base.feedCache.length){base.loopingItem=0;base.noLooping=false;}}}};base.fetchNewItems=function(){var url=base.options.fetchDataUrl+"/Feed/GetEveryoneSocialFeed/";var data={fromTimeUnix:base.timestamp,maxItems:base.options.maxCacheItems}
if(base.options.nickname){url=base.options.fetchDataUrl+"/Feed/GetSocialFeedByNickname/";data.nickname=base.options.nickname;}$.ajax({url:url,cache:false,dataType:'jsonp',jsonp:'jsoncallback',data:data,success:function(result){if(result.success){for(var i=result.Data.length-1;i>=0;i--){if(!base.checkIncludeItem(result.Data[i])){if(base.checkExcludeItem(result.Data[i])){base.feed.unshift(result.Data[i]);}}base.timestamp=$.Leverate.convertJSONDateToTimeStamp(result.Data[i].TimeStamp);}if(result.Data.length>0){base.timestamp=$.Leverate.convertJSONDateToTimeStamp(result.Data[0].TimeStamp);}else{base.$el.find('#preload-message').html('No Items To Display');}}}});},base.checkIncludeItem=function(item){if(base.options.include.length>0){for(var j=0;j<base.options.include.length;j++){var patt=new RegExp(base.options.include[j].toLowerCase(),"gi");if(patt.test(item.InstrumentName.toLowerCase())){base.feed.unshift(item);return true;}}return true;}return false;},base.checkExcludeItem=function(item){if(base.options.exclude.length>0){for(var j=0;j<base.options.exclude.length;j++){var patt=new RegExp(base.options.exclude[j].toLowerCase(),"gi");if(patt.test(item.InstrumentName.toLowerCase())){return false;}}return true;}return true;},base.addFeedItem=function(item){if(!base.noItemsRemoved){base.$el.find(".no-items-to-display").remove();base.noItemsRemoved=true;}var html="",data={};data.name=item.Nickname;data.avatar=item.AvatarURL||"";data.timeAgo=$.Leverate.time_since($.Leverate.convertJSONDateToTimeStamp(item.TimeStamp));data.instrument=item.InstrumentName;data.flag=item.CountryCode||'zz';data.tradeType=item.TradeType;switch(item.TradeType){case 0:data.price=item.OpenPrice;if(item.TradeActionType==0){data.action="Buy";data.actionColor="buy";data.spacer="buy";}else{data.action="Sell";data.actionColor="sell";data.spacer="sell";}break;case 1:data.price=item.ClosePrice;var pl=item.PL*100;data.pl=item.PL>0?pl.toFixed(2)+"%":0;if(item.TradeActionType==0){data.action="Buy";data.actionColor="buy";data.spacer="closed";}else{data.action="Sell";data.actionColor="sell";data.spacer="closed";}break;case 2:data.price=item.Price;if(item.PendingType==0||item.PendingType==1){data.action="Buy";data.actionColor="buy";data.spacer="buy-pending";}else{data.action="Sell";data.actionColor="sell";data.spacer="sell-pending";}break;}var resources=$.Leverate.SocialFeedResources[base.options.language]||$.Leverate.SocialFeedResources['en-us'];html=$.tmpl(base.options.tpl,data,{options:base.options,resources:resources});if(html){var $html=$(html).hide();base.$el.prepend($html);$html.data("feedItem",data);var items=base.$el.children('.social-item');if(items.length>base.options.maxItems){items.last().remove();}$html.slideDown();}};base.init();};$.Leverate.SocialFeed.defaultOptions={addItemInterval:2000,fetchDataInterval:10000,loopWaitTime:30000,socialWidgetClientUrl:'',fetchDataUrl:'https://social-mt2.forexwebservices.com',maxItems:20,maxCacheItems:20,language:'en-us',showCopyButton:true,include:[],exclude:[],copyClick:function(item){},itemSelector:'div.social-item',tpl:['<div class="social-item">','<div class="avatar">','<div class="avatar-image" {{if avatar }}style="background-image:url(${$item.options.socialWidgetClientUrl}/Avatars/GetAvatar/?imageQuary=${avatar});"{{/if}} ><div class="user-flag" style="background-image:url(${$item.options.socialWidgetClientUrl}/Flags/GetFlag/?countryCode=${flag})"></div> </div>','<div class="user-name">${name}</div>','</div>','<div class="content">','{{if tradeType==0 }} <span class="strong ${actionColor}">${action}</span> <span class="strong">${instrument}</span> ${$item.resources["price"]} <span class="price">${price}</span> {{/if}}','{{if tradeType==1 }} ${$item.resources["closed"]} <span class="strong ${actionColor}">${action}</span> <span class="strong">${instrument}</span> ${$item.resources["position"]}  ${$item.resources["price"]} <span class="price">${price}</span> {{if pl != 0 }} , ${$item.resources["gaining"]} <span style="color:green;">${pl}</span>{{/if}} {{/if}}','{{if tradeType==2 }} ${$item.resources["placedOrder"]} <span class="strong ${actionColor}">${action}</span> <span class="strong">${instrument}</span> ${$item.resources["price"]} <span class="price">${price}</span>{{/if}}','</div>','<div > {{if $item.options.showCopyButton == false }}','<div class="action-center"> '+'<div class="social-item-instrument-no-copy" style="background-image:url(${$item.options.socialWidgetClientUrl}/InstrumentsImage/GetImage/?instrumentName=${instrument})" ></div>','</div>  {{else}}','<div class="action">'+'<div class="action-box">','<div class="social-item-instrument" style="background-image:url(${$item.options.socialWidgetClientUrl}/InstrumentsImage/GetImage/?instrumentName=${instrument})" ></div>','<div>'+'<div><button class="feed-action"><span class="x-button-label" id="ext-gen1210"><span class="action-arrow">${$item.resources["copy"]}</span></span></button></div>'+'</div>','</div>','</div> {{/if}}','</div>','<div class="action-spacer ${spacer}"> </div>','</div>'].join("")};$.Leverate.SocialFeed.version='1.0.0.0';$.fn.leverateSocialFeed=function(options){return this.each(function(){(new $.Leverate.SocialFeed(this,options));});};$.Leverate.convertJSONDateToTimeStamp=function(jsonDate){var pattern=/[0-9]+/;var timeStampStr=pattern.exec(jsonDate);var timeStamp=Number(timeStampStr);return timeStamp;},$.Leverate.date_suffix=function(date){if(date==1||date==21||date==31){return'st';}else if(date==2||date==22){return'nd';}else if(date==3||date==23){return'rd';}else{return'th';}};$.Leverate.time_since=function(timeStamp){var original=new Date(timeStamp+(new Date().getTimezoneOffset()*60*1000));var str='';var months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];var chunks=[[31536000000,'year'],[2592000000,'month'],[604800000,'week'],[86400000,'day'],[3600000,'hour'],[60000,'minute'],[1000,'second']];var since=new Date().getTime()-original.getTime();if(since<0){since=60*1000;}if(since>604800000){str=months[original.getMonth()]+' '+original.getDate()+$.Leverate.date_suffix(original.getDate());if(since>31536000000){str=str+', '+original.getFullYear();}return str;}var ms=0;var name=0;var i=0;var ic=chunks.length;var count=0;for(i=0;i<ic;i++){ms=chunks[i][0];name=chunks[i][1];count=Math.floor(since/ms);if(count!=0){break;}}return count+' '+name+((count==1)?'':'s')+' ago';};})(jQuery);$.Leverate.SocialFeedResources={"en-us":{copy:'copy',closed:'closed a',position:'position',price:'at price',gaining:'gaining',placedOrder:'placed an order to'},jp:{copy:'コピー',closed:'クローズA',position:'ポジション',price:'価格で',gaining:'獲得',placedOrder:'に発注した'},fr:{copy:'copier',closed:'a fermé un',position:'position',price:'au cours de',gaining:'avec gain de',placedOrder:'a passé un ordre de'},es:{copy:'copiar',closed:'ha cerrado',position:'posición',price:'a un precio de',gaining:'con una ganancia de',placedOrder:'ha emitido una orden para'},it:{copy:'copia',closed:'ha chiuso una',position:'posizione',price:'al prezzo',gaining:'guadagnando',placedOrder:'ha piazzato un ordine per'},ar:{copy:'نسخ',closed:'تم إغلاق',position:'صفقة',price:'بسعر',gaining:'تكسب',placedOrder:'تم وضع أمر لـ'},sk:{copy:'kopíruj',closed:'uzatvoril',position:'pozíciu',price:'na cene',gaining:'získal',placedOrder:'podal pokyn na'},bg:{copy:'наподобяване',closed:'затворена',position:'позиция',price:'с цена',gaining:'с печалба',placedOrder:'дадена инструкция'},sl:{copy:'posnemaj',closed:'zaprta',position:'položaj',price:'za ceno',gaining:'z dobičkom',placedOrder:'napotek je vnesen'},nl:{copy:'kopieer',closed:'sloot een',position:'positie',price:'tegen de koers',gaining:'en verdiende daarmee',placedOrder:'heeft een order geplaatst'},de:{copy:'kopieren',closed:'geschlossen',position:'position',price:'zum Preis von',gaining:'mit einem Gewinn von',placedOrder:'Order platziert für'},"zh-hans":{copy:'复制',closed:'关闭',position:'位置',price:'价格',gaining:'获得',placedOrder:'下订单'},zh:{copy:'复制',closed:'平仓在',position:'头寸',price:'价格',gaining:'获利',placedOrder:'已经建仓在'},el:{copy:'Αντιγραφή',closed:'Κλείσιμο',position:'Θέσης',price:'Κέρδος',gaining:'Τιμή',placedOrder:'Τοποθέτηση Εντολής'},hu:{copy:'lemásol',closed:'lezárt',position:'pozíciót',price:'árfolyamon',gaining:'nyerő',placedOrder:'megbízást adott le'},nb:{copy:'kopier',closed:'lukket en',position:'posisjon',price:'til pris',gaining:'øker',placedOrder:'plasserer en ordre for'},ru:{copy:'Копировать',closed:'закрыта',position:'позиция',price:'по цене',gaining:'прибыль',placedOrder:'установить приказ'},sr:{copy:'kopiraj',closed:'zatvorio',position:'poziciju',price:'po ceni',gaining:'pri čemu je zaradio',placedOrder:'dao nalog za'},"pt-br":{copy:'copiar',closed:'encerrado a',position:'posição',price:'ao preço',gaining:'ganhos',placedOrder:'efetuou um pedido a'},sv:{copy:'kopiera',closed:'avslutade en',position:'placering',price:'vid pris',gaining:'vinst',placedOrder:'placerade en order till'},ro:{copy:'copiere',closed:'închis la',position:'poziţie',price:'la preţul',gaining:'câştig',placedOrder:'plasarea unui ordin la'},pl:{copy:'naśladuj',closed:'zamknął',position:'pozycja',price:'w cenie',gaining:'zyskiwanie',placedOrder:'złożył zamówienie na'},cs:{copy:'kopie',closed:'zavřel',position:'pozice',price:'za cenu',gaining:'výnos',placedOrder:'zadal objednávku'},tr:{copy:'kopyala',closed:'kapatıldı',position:'pozisyon',price:'şu fiyattan',gaining:'kazanç',placedOrder:'için emir gerçekleştirildi'}};(function($){if(!$.Leverate){$.Leverate=new Object();};$.Leverate.TopPerformers=function(el,options){var self=this;self.$el=$(el);self.el=el;self.noItemsRemoved=false;self.$el.data('Leverate.TopPerformers',self);self.options=$.extend({},$.Leverate.TopPerformers.defaultOptions,options);self.init=function(){self.$el.addClass('top-performers-container').append('<div id="preload-message" class="no-items-to-display"><img alt="" style="vertical-align:-8px;margin-right:5px;" src="'+self.options.socialWidgetClientUrl+'/content/images/website/loader.gif" /> Loading...</div>','<div class="leverate-clearfix frames-tab" style="display:none;"></div>','<div class="leverate-clearfix items-wrapper"></div><div class="leverate-performers-sirix-logo"></div>');if(self.options.tournamentId!=null){self.fetchTournamentItems();}else{self.fetchItems(self.options.defaultPeriod);}}
self.initTimeFrameButtons=function(){var html="";self.$el.find('.frames-tab').show();if(!self.options.showTabs||self.options.tournamentId!=null){self.$el.find('.frames-tab').addClass('no-tabs');}else{var frames=$.Leverate.TopPerformersResources[self.options.language]||$.Leverate.TopPerformersResources['en'];frames=frames.frames;for(var frame in frames){html=$('<div/>').addClass('leverate-fl frame-button').text(frames[frame]);switch(frame){case'oneMonths':html.data('frames',1);break;case'threeMonths':html.data('frames',2);break;case'sixMonths':html.data('frames',3);break;}if(html.data('frames')==self.options.defaultPeriod){html.addClass('selected');}html.bind('click',function(){self.$el.find('.frame-button.selected').removeClass('selected');var itemFrames=$(this).addClass('selected').data('frames');self.fetchItems(itemFrames);});self.$el.find('.frames-tab').append(html);}}}
self.addAllRows=function(allData){if(!self.noItemsRemoved){self.$el.find('.no-items-to-display').remove();self.noItemsRemoved=true;}if(allData.length==0){self.$el.find('.items-wrapper').append('<div>No items to display</div>');return;}var resources=$.Leverate.TopPerformersResources[self.options.language]||$.Leverate.TopPerformersResources['en'];var tableHeaderHtml='<table cellspacing="0" cellpadding="0"><thead><tr>';var tableRowHtml='<tr class="performer-item">';for(var i=0;i<self.options.columnsOrder.length;i++){tableHeaderHtml+=$.Leverate.TopPerformers.uiHeaders[self.options.columnsOrder[i]];tableRowHtml+=$.Leverate.TopPerformers.uiColumns[self.options.columnsOrder[i]];}tableHeaderHtml+='</tr></thead><tbody id="table-rows"></tbody></table>';tableRowHtml+='</tr >';var fakeData={};var tmplHtml=$.tmpl(tableHeaderHtml,fakeData,{resources:resources});tmplHtml.find('.border-right').first().addClass('border-left');self.$el.find('.items-wrapper').append(tmplHtml);for(var j=0;j<allData.length;j++){var rowData=allData[j];var data={};data.name=rowData.Nickname;data.avatar=rowData.Avatar||'';data.flag=rowData.Country||'zz';data.profit=parseFloat(rowData.Profit*100).toFixed(self.options.profitPoint);data.copiers=rowData.Copiers;data.winRate=parseFloat(rowData.WinRatio*100).toFixed(self.options.profitPoint);data.bestPosition=parseFloat(rowData.MaxSingleTradeProfit*100).toFixed(self.options.profitPoint);data.position=j+1;data.days=Math.ceil((new Date()-$.Leverate.TopPerformers.dateTimeReviver(rowData.JoinDate))/86400000);var tableRow=$.tmpl(tableRowHtml,data,{options:self.options,resources:resources});tableRow.find('.button').bind('click',data,function(event){self.options.copyClick(event.data);});self.$el.find('#table-rows').append(tableRow);}}
self.noRows=function(){self.$el.find('.frames-tab').show();self.$el.find('.frames-tab').addClass('no-tabs');self.$el.find('.no-items-to-display').remove();self.noItemsRemoved=true;self.$el.find('.items-wrapper').append('<div class="error">* No items to display</div>');}
self.fetchItems=function(timeFrame){$.ajax({url:self.options.fetchDataUrl+"/UserProfile/GetTopPerformers",cache:false,dataType:'jsonp',jsonp:'jsoncallback',data:{timeFrame:timeFrame,numOfResults:self.options.maxItems},success:function(result){if(self.$el.find('.items-wrapper .performer-item').length>0){self.$el.find('.items-wrapper').empty();}if(result.success){self.addAllRows(result.Data);if(self.$el.find('.frames-tab .frame-button').length==0){self.initTimeFrameButtons();}}else{self.noRows();}}});}
self.fetchTournamentItems=function(){$.ajax({url:self.options.fetchDataUrl+"/UserProfile/GetTournamentTopPerformers",cache:false,dataType:'jsonp',jsonp:'jsoncallback',data:{tournamentId:self.options.tournamentId,numOfResults:self.options.maxItems},success:function(result){if(self.$el.find('.items-wrapper .performer-item').length>0){self.$el.find('.items-wrapper').empty();}if(result.success){self.addAllRows(result.Data);if(self.$el.find('.frames-tab .frame-button').length==0){self.initTimeFrameButtons();}}else{self.noRows();}}});}
self.init();};$.Leverate.TopPerformers.uiColumns={};$.Leverate.TopPerformers.uiColumns["position"]='<td><div class="position">${position}.</div></td>';$.Leverate.TopPerformers.uiColumns["avatar"]='<td><div class="leverate-pr avatar"><img alt="" src="${$item.options.socialWidgetClientUrl}/Avatars/GetAvatar/?imageQuary=${avatar}" /><div class="leverate-pa flag"><img alt="" src="${$item.options.socialWidgetClientUrl}/Flags/GetFlag/?countryCode=${flag}.png" /></div></div></td>';$.Leverate.TopPerformers.uiColumns["nickname"]='<td><div class="user-name">${name}</div></td>';$.Leverate.TopPerformers.uiColumns["bestPosition"]='<td><div class="bestPosition">${bestPosition}%</div></td>';$.Leverate.TopPerformers.uiColumns["copyButton"]='<td><div class="button copy">${$item.resources["copy"]}</div></td>';$.Leverate.TopPerformers.uiColumns["days"]='<td><div class="days">${days}</div></td>';$.Leverate.TopPerformers.uiColumns["winRate"]='<td><div class="win-rate">${winRate}%</div></td>';$.Leverate.TopPerformers.uiColumns["copiers"]='<td><div class="copiers">${copiers}</div></td>';$.Leverate.TopPerformers.uiColumns["profit"]='<td><div class="profit"><div class="profit">${profit}%</div></div></td>';$.Leverate.TopPerformers.uiHeaders={};$.Leverate.TopPerformers.uiHeaders["position"]='<th class="position-header"></th>';$.Leverate.TopPerformers.uiHeaders["avatar"]='<th class="avatar-header"></th>';$.Leverate.TopPerformers.uiHeaders["nickname"]='<th class="nickname-header"></th>';$.Leverate.TopPerformers.uiHeaders["bestPosition"]='<th class="bestPosition-header border-right">${$item.resources["bestPosition"]}</th>';$.Leverate.TopPerformers.uiHeaders["copyButton"]='<th class="copyButton-header"></th>';$.Leverate.TopPerformers.uiHeaders["days"]='<th class="days-header border-right">${$item.resources["days"]}</th>';$.Leverate.TopPerformers.uiHeaders["winRate"]='<th class="winRate-header border-right">${$item.resources["winRate"]}</th>';$.Leverate.TopPerformers.uiHeaders["copiers"]='<th class="copiers-header border-right">${$item.resources["copiers"]}</th>';$.Leverate.TopPerformers.uiHeaders["profit"]='<th class="profit-header border-right">${$item.resources["profit"]}</th>';$.Leverate.TopPerformers.dateTimeReviver=function(value){var a;if(typeof value==='string'){a=/\/Date\((\d*)\)\//.exec(value);if(a){return new Date(+a[1]);}}return value;}
$.Leverate.TopPerformers.defaultOptions={socialWidgetClientUrl:'',fetchDataUrl:'http://qaserver.webtrader.leverate.com:9442',maxItems:10,profitPoint:1,language:'en',copyClick:function(item){},tournamentId:null,showTabs:true,columnsOrder:["position","avatar","nickname","profit","copyButton"],defaultPeriod:1};$.Leverate.TopPerformers.version='1.0.0.0';$.fn.leverateTopPerformers=function(options){return this.each(function(){(new $.Leverate.TopPerformers(this,options));});}})(jQuery);$.Leverate.TopPerformersResources={en:{days:'Days in social',winRate:'Success rate',copiers:'Copiers',profit:'Profit',bestPosition:'Best position',copy:'Copy',frames:{oneMonths:'1 Month',threeMonths:'3 Months',sixMonths:'6 Months'}},jp:{days:'Days in social',winRate:'Success rate',copiers:'Copiers',profit:'Profit',bestPosition:'Best position',copy:'コピー',frames:{oneMonths:'1ヶ月',threeMonths:'3ヶ月間',sixMonths:'6ヶ月'}},fr:{days:'Days in social',winRate:'Success rate',copiers:'Copiers',profit:'Profit',bestPosition:'Best position',copy:'Copier',frames:{oneMonths:'1 Mois',threeMonths:'3 Mois',sixMonths:'6 Mois'}}};(function($){if(!$.Leverate){$.Leverate=new Object();}$.Leverate.FeaturedUser=function(el,options){var self=this;self.$el=$(el);self.el=el;self.$el.data('Leverate.FeaturedUser',self);var ranks={0:'Champion',1:'Grand Master',2:'Master',3:'Expert',4:'Trader'};self.init=function(){self.options=$.extend({},$.Leverate.FeaturedUser.defaultOptions,options);self.$el.addClass('profile-cube-container').append('<div class="leverate-featureduser-sirix-logo"></div>');self.fetchItem();}
self.fetchItem=function(){$.ajax({url:self.options.fetchDataUrl+'/UserProfile/GetRandomTopPerformer',cache:false,dataType:'jsonp',jsonp:'jsoncallback',success:function(result){var data={};data.avatar=result.Data.Avatar?result.Data.Avatar:"defaultAvatar1";data.flag=result.Data.Country||'zz';data.name=result.Data.Nickname;data.risk=parseFloat(result.Data.RiskLevel).toFixed(2);;data.pl=parseFloat(result.Data.Profit*100).toFixed(2);data.pl=data.pl>500?'>500':data.pl;data.rank=result.Data.ProficiencyLevel;data.rankAsString=self.rankToString(data.rank);data.rankImage=data.rankAsString.replace(' ','');var resources=$.Leverate.FeaturedUserResources[self.options.language]||$.Leverate.FeaturedUserResources['en'];var html=$.tmpl(self.options.tpl,data,{options:self.options,resources:resources});if(html){self.$el.append(html);}}});}
self.rankToString=function(rank){return ranks[rank];}
self.init();}
$.Leverate.FeaturedUser.defaultOptions={socialWidgetClientUrl:'',fetchDataUrl:'http://qaserver.webtrader.leverate.com:9442',language:'en',tpl:['<div class="cube-title">','<div class="text">${$item.resources["title"]}</div>','</div>','<div class="badge"><img alt="" src="${$item.options.socialWidgetClientUrl}/Badges/GetBadge/?badgeQuery=${rankImage}" /></div>','<div class="leverate-clearfix personal">','<div class="leverate-fl left">','<div class="leverate-center image">','<img alt="" src="${$item.options.socialWidgetClientUrl}/Avatars/GetAvatar/?imageQuary=${avatar}" />','<div class="flag"><img alt="" src="${$item.options.socialWidgetClientUrl}/Flags/GetFlag/?countryCode=${flag}" /></div>','</div>','</div>','<div class="leverate-fl right">','<div class="user-name">${name}</div>','<div class="leverate-clearfix rank">','<div class="leverate-fl icon"><img alt="" src="${$item.options.socialWidgetClientUrl}/Content/Images/Badges/medal.gif" /></div>','<div class="leverate-fl text">${rankAsString}</div>','</div>','</div>','</div>','<div class="user-data">','<div class="leverate-clearfix data-row">','<div class="leverate-fl key"><span>${$item.resources["keys"]["pl"]}</span></div>','<div class="leverate-fl value positive"><span>${pl}%</span></div>','</div>','<div class="leverate-clearfix data-row">','<div class="leverate-fl key"><span>${$item.resources["keys"]["risk"]}</span></div>','<div class="leverate-fl value"><span>${risk} / 10</span></div>','</div>','</div>'].join("")};$.Leverate.FeaturedUser.version='1.0.0.0';$.fn.leverateFeaturedUser=function(options){return this.each(function(){(new $.Leverate.FeaturedUser(this,options));});}})(jQuery);$.Leverate.FeaturedUserResources={en:{title:'spotlight',keys:{pl:'P/L (%)',risk:'Risk',joined:'Joined'}},jp:{title:'スポットライト',keys:{pl:'損益 (%)',risk:'リスク',joined:'参加しました'}},fr:{title:'spotlight',keys:{pl:'P/L (%)',risk:'Risk',joined:'Joined'}}};var EngineType={Poll:1,Push:2};function PollRatesEngine(obj){this.interval=null;this.intervalTime=obj.intervalTime*1000;this.intervalTime=this.intervalTime<(5*1000)?(5*1000):this.intervalTime;this.lastServerTime=0;this.fetchDataUrl=obj.fetchDataUrl||'http://localhost:51525';this.instruments=obj.instruments?obj.instruments.join(','):'';this.lock=false;return this;}PollRatesEngine.prototype.start=function(callback){var self=this;this.lastServerTime=0;this.requestData(callback||function(){});self.interval=window.setInterval(function(){self.requestData(callback);},self.intervalTime);return this;}
PollRatesEngine.prototype.stop=function(){if(this.interval){window.clearInterval(this.interval);this.interval=null;}return this;}
PollRatesEngine.prototype.requestData=function(callback){var self=this;if(!self.lock&&self.instruments){self.lock=true;$.ajax({url:self.fetchDataUrl+'/MarketRates/GetData',cache:false,dataType:'jsonp',jsonp:'jsoncallback',data:{crosses:self.instruments,lastServerTime:self.lastServerTime},success:function(result){self.lock=false;self.lastServerTime=result.Data.ServerTime;if(callback){callback.call(result);}}});}return this;}
PollRatesEngine.prototype.setInstruments=function(instruments){if(instruments&&typeof instruments==='object'){this.instruments=instruments.join(',');}return this;}
function PushRatesEngine(obj){this.fetchDataUrl=obj.fetchDataUrl||'http://localhost:51525';this.instruments=obj.instruments?obj.instruments.join(','):'';this.lock=false;this.started=false;$.connection.hub.url=this.fetchDataUrl+'/signalr';this.marketRatesHub=$.connection.marketRatesHub;return this;}PushRatesEngine.prototype.start=function(callback){var self=this;self.marketRatesHub.update=function(obj){if(callback&&obj){callback.call(obj);}}
$.connection.hub.start({xdomain:true,transport:['longPolling','webSockets']}).done(function(){self.started=true;self.marketRatesHub.addToGroups(self.instruments).done(function(){});});return this;}
PushRatesEngine.prototype.stop=function(){if(this.started){this.marketRatesHub.removeFromGroups(this.instruments).done(function(){});}return this;}
PushRatesEngine.prototype.setInstruments=function(instruments){if(instruments&&typeof instruments==='object'){this.instruments=instruments.join(',');}return this;}
if(!$.Leverate){$.Leverate=new Object();};(function($){if(!$.Leverate){$.Leverate=new Object();};$.Leverate.MarketRatesGrid=function(el,options){var self=this;self.$el=$(el);self.el=el;self.$el.data('Leverate.MarketRatesGrid',self);self.engine=null;self.selectedTab='';self.init=function(){self.options=$.extend({},$.Leverate.MarketRatesGrid.defaultOptions,options);self.initSpread=function(){if(self.options.showSpread){self.$el.addClass('leverate-rates-grid-container leverate-rates-grid-withspeard').append('<div class="leverate-ratesgrid-sirix-logo"></div>');self.options.tpl=['<div class="leverate-clearfix leverate-table-row">','<div class="leverate-fl leverate-row-item leverate-item-instrument"><img alt="" src="${$item.options.socialWidgetClientUrl}/InstrumentsImage/GetImage/?instrumentName=${instrument}" /></div>','<div class="leverate-fl leverate-row-item leverate-item-symbol">${symbol}</div>','<div class="leverate-fl leverate-row-item leverate-item-arrow leverate-arrow-${arrow}"></div>','<div class="leverate-fl leverate-row-item leverate-item-bid">{{html bid}}</div>','<div class="leverate-fl leverate-row-item leverate-item-ask">{{html ask}}</div>','<div class="leverate-fl leverate-row-item leverate-item-spread">{{html spread}}</div>','</div>'].join('');}else{self.$el.addClass('leverate-rates-grid-container').append('<div class="leverate-ratesgrid-sirix-logo"></div>');}};self.initSpread();self.$el.addClass('leverate-rates-grid-container').append('<div class="leverate-ratesgrid-sirix-logo"></div>');self.$el.append('<div class="leverate-clearfix leverate-rates-tabs"></div>','<div class="leverate-clearfix leverate-grid-header">'+'<div class="leverate-fl leverate-header-item leverate-item-symbol">Symbol</div>'+'<div class="leverate-fl leverate-header-item leverate-item-bid">Bid</div>'+'<div class="leverate-fl leverate-header-item leverate-item-ask">Ask</div>'+(self.options.showSpread?'<div class="leverate-fl leverate-header-item leverate-item-spread">Spread</div>':'')+'</div><div class="leverate-clearfix leverate-rates-grids"></div>');switch(self.options.engine){case EngineType.Poll:self.engine=new PollRatesEngine({intervalTime:self.options.updateInterval,fetchDataUrl:self.options.fetchDataUrl});break;case EngineType.Push:self.engine=new PushRatesEngine({fetchDataUrl:self.options.fetchDataUrl});break;}self.initTabs();}
self.changeTab=function(group){if(self.options.groups[group]){if(self.engine){self.engine.stop();}$('.leverate-rates-tab.leverate-tab-selected').removeClass('leverate-tab-selected');$('.leverate-rates-tab.'+group+'-tab').addClass('leverate-tab-selected');$('.leverate-grid-table.leverate-table-selected').removeClass('leverate-table-selected');$('.leverate-grid-table.'+group+'-table').addClass('leverate-table-selected');self.selectedTab=group;self.engine.setInstruments(self.groupToCrossesArray(self.options.groups[group]));self.engine.start(function(){self.fetchGroupData(this);});}}
self.groupToCrossesArray=function(groupData){var result=[];for(var i=0,len=groupData.length;i<len;i++){if(typeof groupData[i]==='string'){result.push(groupData[i]);}else if(typeof groupData[i]==='object'&&groupData[i].name){result.push(groupData[i].name);}}return result;}
self.calcSpread=function(ask,bid,pipDigit){return Math.pow(10,pipDigit)*(ask-bid);}
self.fetchGroupData=function(data){var $table=$('.leverate-grid-table.leverate-table-selected');if(data.Data){var ratesMap={};var rateNameMatch;var currentRates=this.options.groups[this.selectedTab];for(var i=0,total=data.Data.Rates.length;i<total;i++){var dataRateName=data.Data.Rates[i].Name;for(var j=0,len=currentRates.length;j<len;j++){if(typeof currentRates[j]=='object')rateNameMatch=currentRates[j].name;else
rateNameMatch=currentRates[j];if(new RegExp(rateNameMatch).test(dataRateName)){ratesMap[dataRateName]=data.Data.Rates[i];break;}}}for(var rateNameKey in ratesMap){var $row=$table.find('.leverate-table-row:contains("'+rateNameKey+'")');var precision=self.getPrecision(rateNameKey);if($row.length>0){self.updateTableRow($row,ratesMap[rateNameKey],precision);}else{self.addTableRow($table,ratesMap[rateNameKey],precision);}}}else{var $row=$table.find('.leverate-table-row:contains("'+data.Name+'")');var precision=self.getPrecision(data.Name);if($row.length>0){self.updateTableRow($row,data,precision);}else{self.addTableRow($table,data,precision);}}}
self.getPrecision=function(name){var result=0;var len=self.options.groups[self.selectedTab].length;for(var i=0;i<len;i++){if(typeof self.options.groups[self.selectedTab][i]==='object'&&self.options.groups[self.selectedTab][i].name==name){result=self.options.groups[self.selectedTab][i].precision;break;}}return result;}
self.updateTableRow=function(row,data,precision){var html='',tpldata={};tpldata.instrument=data.Name;tpldata.symbol=data.Name;tpldata.arrow=parseFloat(data.Bid)-parseFloat(row.find('.leverate-item-bid').text())>=0?'up':'down';tpldata.bid=data.Bid.toFixedHtml(precision);tpldata.ask=data.Ask.toFixedHtml(precision);tpldata.spread=self.calcSpread(data.Ask,data.Bid,precision);html=$.tmpl(self.options.tpl,tpldata,{options:self.options});row.replaceWith(html);}
self.addTableRow=function(table,data,precision){var html='',tpldata={};tpldata.instrument=data.Name;tpldata.symbol=data.Name;tpldata.arrow='up';tpldata.bid=data.Bid.toFixedHtml(precision);tpldata.ask=data.Ask.toFixedHtml(precision);tpldata.spread=self.calcSpread(data.Ask,data.Bid,precision);html=$.tmpl(self.options.tpl,tpldata,{options:self.options});if(html){table.append(html);}}
self.initTabs=function(){for(var group in self.options.groups){if(!self.selectedTab){self.selectedTab=group;}var tabHtml=$('<div class="leverate-fl leverate-rates-tab '+group+'-tab"></div>').text(group);tabHtml.data('group-name',group);var tableHtml=$('<div class="leverate-grid-table '+group+'-table"></div>');self.$el.find('.leverate-rates-tabs').append(tabHtml);self.$el.find('.leverate-rates-grids').append(tableHtml);}$('.leverate-rates-tab').live('click',function(){var group=$(this).data('group-name');self.changeTab(group);});self.changeTab(self.selectedTab);}
Number.prototype.toFixedHtml=function(precision){var self=this;if(precision){self=self.toFixed(precision);}self=self.toString();var pointIdx=self.indexOf('.');if(pointIdx>-1){pointIdx+=1;var delta=self.length-pointIdx;if(delta%2==0){self=self.substring(0,self.length-2)+'<span style="font-size:1.167em;font-weight:bold;">'+self.substring(self.length-2,self.length)+'</span>';}else{self=self.substring(0,self.length-3)+'<span style="font-size:1.167em;font-weight:bold;">'+self.substring(self.length-3,self.length-1)+'</span><span style="font-size:0.833em;">'+self.substring(self.length-1,self.length)+'</span>'}}return self;}
self.init();};$.Leverate.MarketRatesGrid.defaultOptions={socialWidgetClientUrl:'',fetchDataUrl:'https://webrates.forexwebservices.com',engine:EngineType.Poll,updateInterval:5,showSpread:false,groups:{Forex:[{name:'EURUSD',precision:3},'EURGBP','GBPUSD'],Commodities:['WTI','Gold','Silver','Suger','Oil',],Indices:['NSDQ','FTSE','CAC','DOW','SP500','DAX'],Stocks:['APPLE','GOOGLE','INTEL','YAHOO','MSFT','IBM']},language:'en',tpl:['<div class="leverate-clearfix leverate-table-row">','<div class="leverate-fl leverate-row-item leverate-item-instrument"><img alt="" src="${$item.options.socialWidgetClientUrl}/InstrumentsImage/GetImage/?instrumentName=${instrument}" /></div>','<div class="leverate-fl leverate-row-item leverate-item-symbol">${symbol}</div>','<div class="leverate-fl leverate-row-item leverate-item-arrow leverate-arrow-${arrow}"></div>','<div class="leverate-fl leverate-row-item leverate-item-bid">{{html bid}}</div>','<div class="leverate-fl leverate-row-item leverate-item-ask">{{html ask}}</div>','</div>'].join('')};$.Leverate.MarketRatesGrid.version='1.0.0.0';$.fn.leverateMarketRatesGrid=function(options){return this.each(function(){(new $.Leverate.MarketRatesGrid(this,options));});}})(jQuery);$.Leverate.MarketRatesGridResources={en:{},fn:{}};if(!$.Leverate){$.Leverate=new Object();};(function($){if(!$.Leverate){$.Leverate=new Object();};$.Leverate.MarketRatesTicker=function(el,options){var self=this;self.$el=$(el);self.el=el;self.$el.data('Leverate.MarketRatesTicker',self);self.engine=null;self.animationStarted=false;self.init=function(){self.options=$.extend({},$.Leverate.MarketRatesTicker.defaultOptions,options);self.$el.addClass('leverate-rates-ticker-container leverate-ticker-'+self.options.skin).append('<div class="sirix-ticker-logo-wrapper"><div class="sirix-ticker-logo"></div></div>');self.$el.append('<div class="leverate-rates-animated-row leverate-clearfix"></div>');switch(self.options.engine){case EngineType.Poll:self.engine=new PollRatesEngine({intervalTime:self.options.updateInterval,fetchDataUrl:self.options.fetchDataUrl});break;case EngineType.Push:self.engine=new PushRatesEngine({fetchDataUrl:self.options.fetchDataUrl});break;}self.startEngine();}
self.startEngine=function(){self.engine.setInstruments(self.instrumentsToCrossesArray(self.options.instruments));self.engine.start(function(){self.fetchTickerData(this);});}
self.instrumentsToCrossesArray=function(){var result=[];for(var i=0,len=self.options.instruments.length;i<len;i++){if(typeof self.options.instruments[i]==='string'){result.push(self.options.instruments[i]);}else if(typeof self.options.instruments[i]==='object'&&self.options.instruments[i].name){result.push(self.options.instruments[i].name);}}return result;}
self.fetchTickerData=function(data){var $animatedRow=self.$el.find('.leverate-rates-animated-row');if(data.Data){for(var i=0,len=data.Data.Rates.length;i<len;i++){var $item=$animatedRow.find('.leverate-rates-item:contains("'+data.Data.Rates[i].Name+'")');var precision=self.getPrecision(data.Data.Rates[i].Name);if($item.length>0){self.updateTickerItem($item,data.Data.Rates[i],precision);}else{self.addTickerItem($animatedRow,data.Data.Rates[i],precision);}}}else{var $item=$animatedRow.find('.leverate-rates-item:contains("'+data.Name+'")');var precision=self.getPrecision(data.Name);if($item.length>0){self.updateTickerItem($item,data,precision);}else{self.addTickerItem($animatedRow,data,precision);}}}
self.getPrecision=function(name){var result=0;var len=self.options.instruments.length;for(var i=0;i<len;i++){if(typeof self.options.instruments[i]==='object'&&self.options.instruments[i].name==name){result=self.options.instruments[i].precision;break;}}return result;}
self.updateTickerItem=function(item,data,precision){var html='',tpldata={};tpldata.arrow=parseFloat(data.Bid)-parseFloat(item.find('.leverate-item-bid').text())>=0?'leverate-arrow-up':'leverate-arrow-down';tpldata.bid=data.Bid.toFixedHtml(precision);tpldata.ask=data.Ask.toFixedHtml(precision);item.find('.leverate-item-arrow').removeClass('leverate-arrow-up').removeClass('leverate-arrow-down').addClass(tpldata.arrow);item.find('.leverate-item-bid').html(tpldata.bid);item.find('.leverate-item-ask').html(tpldata.ask);}
self.addTickerItem=function(animatedRow,data,precision){var html='',tpldata={};tpldata.arrow='up'
tpldata.symbol=data.Name;tpldata.bid=data.Bid.toFixedHtml(precision);tpldata.ask=data.Ask.toFixedHtml(precision);html=$.tmpl(self.options.tpl,tpldata,{options:self.options});if(html){var w=parseInt(animatedRow.css('width'))+270;animatedRow.css('width',w+'px');animatedRow.append(html);var cw=parseInt(self.$el.css('width'));if(!self.animationStarted&&cw<w){self.animationStarted=true;self.startAnimation();}}}
self.startAnimation=function(){var $firstItem=$(self.$el.find('.leverate-rates-animated-row .leverate-rates-item')[0]);var $animatedRow=self.$el.find('.leverate-rates-animated-row');$firstItem.animate({'margin-left':'-270px'},self.options.speed,'linear',function(){$(this).remove();$firstItem.css('margin-left','');$animatedRow.append($firstItem);self.startAnimation();});}
Number.prototype.toFixedHtml=function(precision){var self=this;if(precision){self=self.toFixed(precision);}self=self.toString();var pointIdx=self.indexOf('.');if(pointIdx>-1){pointIdx+=1;var delta=self.length-pointIdx;if(delta%2==0){self=self.substring(0,self.length-2)+'<span style="font-size:1.167em;font-weight:bold;">'+self.substring(self.length-2,self.length)+'</span>';}else{self=self.substring(0,self.length-3)+'<span style="font-size:1.167em;font-weight:bold;">'+self.substring(self.length-3,self.length-1)+'</span><span style="font-size:0.833em;">'+self.substring(self.length-1,self.length)+'</span>'}}return self;}
self.init();};$.Leverate.MarketRatesTicker.defaultOptions={socialWidgetClientUrl:'',fetchDataUrl:'https://webrates.forexwebservices.com',engine:EngineType.Poll,updateInterval:5,speed:5000,skin:'dark',instruments:[{name:'EURUSD',precision:3},'EURGBP','GBPUSD',{name:'EURCHF',precision:5},'USDCHF','GBPCHF','NZDJPY','AUDNZD','AUDCAD','CADJPY','CHFJPY','CADCHF'],tpl:['<div class="leverate-rates-item">','<div class="leverate-item-symbol-icon"><img alt="" src="${$item.options.socialWidgetClientUrl}/InstrumentsImage/GetImage/?instrumentName=${symbol}" /></div>','<div class="leverate-item-arrow leverate-arrow-${arrow}"></div>','<div class="leverate-item-symbol">${symbol}</div>','<div class="leverate-item-rate"><span class="leverate-item-bid">{{html bid}}</span> / <span class="leverate-item-ask">{{html ask}}</span></div>','</div>'].join('')};$.Leverate.MarketRatesTicker.version='1.0.0.0';$.fn.leverateMarketRatesTicker=function(options){return this.each(function(){(new $.Leverate.MarketRatesTicker(this,options));});}})(jQuery);(function(a){var r=a.fn.domManip,d="_tmplitem",q=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,b={},f={},e,p={key:0,data:{}},h=0,c=0,l=[];function g(e,d,g,i){var c={data:i||(d?d.data:{}),_wrap:d?d._wrap:null,tmpl:null,parent:d||null,nodes:[],calls:u,nest:w,wrap:x,html:v,update:t};e&&a.extend(c,e,{nodes:[],parent:d});if(g){c.tmpl=g;c._ctnt=c._ctnt||c.tmpl(a,c);c.key=++h;(l.length?f:b)[h]=c}return c}a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(f,d){a.fn[f]=function(n){var g=[],i=a(n),k,h,m,l,j=this.length===1&&this[0].parentNode;e=b||{};if(j&&j.nodeType===11&&j.childNodes.length===1&&i.length===1){i[d](this[0]);g=this}else{for(h=0,m=i.length;h<m;h++){c=h;k=(h>0?this.clone(true):this).get();a.fn[d].apply(a(i[h]),k);g=g.concat(k)}c=0;g=this.pushStack(g,f,i.selector)}l=e;e=null;a.tmpl.complete(l);return g}});a.fn.extend({tmpl:function(d,c,b){return a.tmpl(this[0],d,c,b)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(d,l,j){if(d[0]&&d[0].nodeType){var f=a.makeArray(arguments),g=d.length,i=0,h;while(i<g&&!(h=a.data(d[i++],"tmplItem"))){;}if(g>1){f[0]=[a.makeArray(d)];}if(h&&c){f[2]=function(b){a.tmpl.afterManip(this,b,j)};}r.apply(this,f)}else{r.apply(this,arguments);}c=0;!e&&a.tmpl.complete(b);return this}});a.extend({tmpl:function(d,h,e,c){var j,k=!c;if(k){c=p;d=a.template[d]||a.template(null,d);f={}}else if(!d){d=c.tmpl;b[c.key]=c;c.nodes=[];c.wrapped&&n(c,c.wrapped);return a(i(c,null,c.tmpl(a,c)))}if(!d){return[];}if(typeof h==="function"){h=h.call(c||{});}e&&e.wrapped&&n(e,e.wrapped);j=a.isArray(h)?a.map(h,function(a){return a?g(e,c,d,a):null}):[g(e,c,d,h)];return k?a(i(c,null,j)):j},tmplItem:function(b){var c;if(b instanceof a){b=b[0];}while(b&&b.nodeType===1&&!(c=a.data(b,"tmplItem"))&&(b=b.parentNode)){;}return c||p},template:function(c,b){if(b){if(typeof b==="string"){b=o(b);}else if(b instanceof a){b=b[0]||{};}if(b.nodeType){b=a.data(b,"tmpl")||a.data(b,"tmpl",o(b.innerHTML));}return typeof c==="string"?(a.template[c]=b):b}return c?typeof c!=="string"?a.template(null,c):a.template[c]||a.template(null,q.test(c)?c:a(c)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(){b={}},afterManip:function(f,b,d){var e=b.nodeType===11?a.makeArray(b.childNodes):b.nodeType===1?[b]:[];d.call(f,b);m(e);c++}});function i(e,g,f){var b,c=f?a.map(f,function(a){return typeof a==="string"?e.key?a.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+d+'="'+e.key+'" $2'):a:i(a,e,a._ctnt)}):e;if(g){return c;}c=c.join("");c.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(f,c,e,d){b=a(e).get();m(b);if(c){b=j(c).concat(b);}if(d){b=b.concat(j(d))}});return b?b:j(c)}function j(c){var b=document.createElement("div");b.innerHTML=c;return a.makeArray(b.childNodes)}function o(b){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+a.trim(b).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(m,l,j,d,b,c,e){var i=a.tmpl.tag[j],h,f,g;if(!i){throw"Template command not found: "+j;}h=i._default||[];if(c&&!/\w$/.test(b)){b+=c;c=""}if(b){b=k(b);e=e?","+k(e)+")":c?")":"";f=c?b.indexOf(".")>-1?b+c:"("+b+").call($item"+e:b;g=c?f:"(typeof("+b+")==='function'?("+b+").call($item):("+b+"))"}else{g=f=h.$1||"null";}d=k(d);return"');"+i[l?"close":"open"].split("$notnull_1").join(b?"typeof("+b+")!=='undefined' && ("+b+")!=null":"true").split("$1a").join(g).split("$1").join(f).split("$2").join(d?d.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(d,c,b,a){a=a?","+a+")":b?")":"";return a?"("+c+").call($item"+a:d}):h.$2||"")+"_.push('"})+"');}return _;")}function n(c,b){c._wrap=i(c,true,a.isArray(b)?b:[q.test(b)?b:a(b).html()]).join("")}function k(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function s(b){var a=document.createElement("div");a.appendChild(b.cloneNode(true));return a.innerHTML}function m(o){var n="_"+c,k,j,l={},e,p,i;for(e=0,p=o.length;e<p;e++){if((k=o[e]).nodeType!==1){continue;}j=k.getElementsByTagName("*");for(i=j.length-1;i>=0;i--){m(j[i]);}m(k)}function m(j){var p,i=j,k,e,m;if(m=j.getAttribute(d)){while(i.parentNode&&(i=i.parentNode).nodeType===1&&!(p=i.getAttribute(d))){;}if(p!==m){i=i.parentNode?i.nodeType===11?0:i.getAttribute(d)||0:0;if(!(e=b[m])){e=f[m];e=g(e,b[i]||f[i],null,true);e.key=++h;b[h]=e}c&&o(m)}j.removeAttribute(d)}else if(c&&(e=a.data(j,"tmplItem"))){o(e.key);b[e.key]=e;i=a.data(j.parentNode,"tmplItem");i=i?i.key:0}if(e){k=e;while(k&&k.key!=i){k.nodes.push(j);k=k.parent}delete e._ctnt;delete e._wrap;a.data(j,"tmplItem",e)}function o(a){a=a+n;e=l[a]=l[a]||g(e,b[e.parent.key+n]||e.parent,null,true)}}}function u(a,d,c,b){if(!a){return l.pop();}l.push({_:a,tmpl:d,item:this,data:c,options:b})}function w(d,c,b){return a.tmpl(a.template(d),c,b,this)}function x(b,d){var c=b.options||{};c.wrapped=d;return a.tmpl(a.template(b.tmpl),b.data,c,b.item)}function v(d,c){var b=this._wrap;return a.map(a(a.isArray(b)?b.join(""):b).filter(d||"*"),function(a){return c?a.innerText||a.textContent:a.outerHTML||s(a)})}function t(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]);a(b).remove()}})(jQuery);if(!$.Leverate){$.Leverate=new Object();};(function($){if(!$.Leverate){$.Leverate=new Object();};$.Leverate.SocialFeed=function(el,options){var base=this;base.$el=$(el);base.el=el;base.currentItems=0;base.feed=[];base.feedCache=[];base.timestamp=0,base.noItemsRemoved=false,base.noLooping=false,base.loopingItem=0,base.mouseover=false,base.lastItemTimestamp=0;base.$el.data("Leverate.SocialFeed",base);base.init=function(){base.options=$.extend({},$.Leverate.SocialFeed.defaultOptions,options);base.start();base.$el.find(".feed-action").live('click',function(){var data=$(this).parentsUntil(base.$el,base.options.itemSelector).data("feedItem");base.options.copyClick(data);});base.$el.mouseover(function(){base.mouseover=true;});base.$el.mouseout(function(){base.mouseover=false;});base.$el.addClass('social-feed-container').append('<div id="preload-message" class="no-items-to-display"><img alt="" style="vertical-align:-8px;margin-right:5px;" src="'+base.options.socialWidgetClientUrl+'/content/images/website/loader.gif" /> Loading...</div><div class="leverate-feed-sirix-logo"></div>');};base.start=function(){base.fetchNewItems();setInterval(base.checkForNewItems,base.options.addItemInterval);setInterval(base.fetchNewItems,base.options.fetchDataInterval);};base.checkForNewItems=function(){if(base.mouseover){return;}var item=null;if(base.feed.length>0&&!base.noLooping){item=base.feed.pop();base.addFeedItem(item);base.lastItemTimestamp=new Date().getTime();base.feedCache.unshift(item);if(base.feedCache.length>base.options.maxCacheItems){base.feedCache.pop();}}else{var date=new Date().getTime()-base.lastItemTimestamp;if(base.noLooping||(base.feedCache.length>0&&date>base.options.loopWaitTime)){item=base.feedCache.pop();base.addFeedItem(item);base.feedCache.unshift(item);base.noLooping=true;base.loopingItem++;if(base.loopingItem>=base.feedCache.length){base.loopingItem=0;base.noLooping=false;}}}};base.fetchNewItems=function(){var url=base.options.fetchDataUrl+"/Feed/GetEveryoneSocialFeed/";var data={fromTimeUnix:base.timestamp,maxItems:base.options.maxCacheItems}
if(base.options.nickname){url=base.options.fetchDataUrl+"/Feed/GetSocialFeedByNickname/";data.nickname=base.options.nickname;}$.ajax({url:url,cache:false,dataType:'jsonp',jsonp:'jsoncallback',data:data,success:function(result){if(result.success){for(var i=result.Data.length-1;i>=0;i--){if(!base.checkIncludeItem(result.Data[i])){if(base.checkExcludeItem(result.Data[i])){base.feed.unshift(result.Data[i]);}}base.timestamp=$.Leverate.convertJSONDateToTimeStamp(result.Data[i].TimeStamp);}if(result.Data.length>0){base.timestamp=$.Leverate.convertJSONDateToTimeStamp(result.Data[0].TimeStamp);}else{base.$el.find('#preload-message').html('No Items To Display');}}}});},base.checkIncludeItem=function(item){if(base.options.include.length>0){for(var j=0;j<base.options.include.length;j++){var patt=new RegExp(base.options.include[j].toLowerCase(),"gi");if(patt.test(item.InstrumentName.toLowerCase())){base.feed.unshift(item);return true;}}return true;}return false;},base.checkExcludeItem=function(item){if(base.options.exclude.length>0){for(var j=0;j<base.options.exclude.length;j++){var patt=new RegExp(base.options.exclude[j].toLowerCase(),"gi");if(patt.test(item.InstrumentName.toLowerCase())){return false;}}return true;}return true;},base.addFeedItem=function(item){if(!base.noItemsRemoved){base.$el.find(".no-items-to-display").remove();base.noItemsRemoved=true;}var html="",data={};data.name=item.Nickname;data.avatar=item.AvatarURL||"";data.timeAgo=$.Leverate.time_since($.Leverate.convertJSONDateToTimeStamp(item.TimeStamp));data.instrument=item.InstrumentName;data.flag=item.CountryCode||'zz';data.tradeType=item.TradeType;switch(item.TradeType){case 0:data.price=item.OpenPrice;if(item.TradeActionType==0){data.action="Buy";data.actionColor="buy";data.spacer="buy";}else{data.action="Sell";data.actionColor="sell";data.spacer="sell";}break;case 1:data.price=item.ClosePrice;var pl=item.PL*100;data.pl=item.PL>0?pl.toFixed(2)+"%":0;if(item.TradeActionType==0){data.action="Buy";data.actionColor="buy";data.spacer="closed";}else{data.action="Sell";data.actionColor="sell";data.spacer="closed";}break;case 2:data.price=item.Price;if(item.PendingType==0||item.PendingType==1){data.action="Buy";data.actionColor="buy";data.spacer="buy-pending";}else{data.action="Sell";data.actionColor="sell";data.spacer="sell-pending";}break;}var resources=$.Leverate.SocialFeedResources[base.options.language]||$.Leverate.SocialFeedResources['en-us'];html=$.tmpl(base.options.tpl,data,{options:base.options,resources:resources});if(html){var $html=$(html).hide();base.$el.prepend($html);$html.data("feedItem",data);var items=base.$el.children('.social-item');if(items.length>base.options.maxItems){items.last().remove();}$html.slideDown();}};base.init();};$.Leverate.SocialFeed.defaultOptions={addItemInterval:2000,fetchDataInterval:10000,loopWaitTime:30000,socialWidgetClientUrl:'',fetchDataUrl:'https://social-mt2.forexwebservices.com',maxItems:20,maxCacheItems:20,language:'en-us',showCopyButton:true,include:[],exclude:[],copyClick:function(item){},itemSelector:'div.social-item',tpl:['<div class="social-item">','<div class="avatar">','<div class="avatar-image" {{if avatar }}style="background-image:url(${$item.options.socialWidgetClientUrl}/Avatars/GetAvatar/?imageQuary=${avatar});"{{/if}} ><div class="user-flag" style="background-image:url(${$item.options.socialWidgetClientUrl}/Flags/GetFlag/?countryCode=${flag})"></div> </div>','<div class="user-name">${name}</div>','</div>','<div class="content">','{{if tradeType==0 }} <span class="strong ${actionColor}">${action}</span> <span class="strong">${instrument}</span> ${$item.resources["price"]} <span class="price">${price}</span> {{/if}}','{{if tradeType==1 }} ${$item.resources["closed"]} <span class="strong ${actionColor}">${action}</span> <span class="strong">${instrument}</span> ${$item.resources["position"]}  ${$item.resources["price"]} <span class="price">${price}</span> {{if pl != 0 }} , ${$item.resources["gaining"]} <span style="color:green;">${pl}</span>{{/if}} {{/if}}','{{if tradeType==2 }} ${$item.resources["placedOrder"]} <span class="strong ${actionColor}">${action}</span> <span class="strong">${instrument}</span> ${$item.resources["price"]} <span class="price">${price}</span>{{/if}}','</div>','<div > {{if $item.options.showCopyButton == false }}','<div class="action-center"> '+'<div class="social-item-instrument-no-copy" style="background-image:url(${$item.options.socialWidgetClientUrl}/InstrumentsImage/GetImage/?instrumentName=${instrument})" ></div>','</div>  {{else}}','<div class="action">'+'<div class="action-box">','<div class="social-item-instrument" style="background-image:url(${$item.options.socialWidgetClientUrl}/InstrumentsImage/GetImage/?instrumentName=${instrument})" ></div>','<div>'+'<div><button class="feed-action"><span class="x-button-label" id="ext-gen1210"><span class="action-arrow">${$item.resources["copy"]}</span></span></button></div>'+'</div>','</div>','</div> {{/if}}','</div>','<div class="action-spacer ${spacer}"> </div>','</div>'].join("")};$.Leverate.SocialFeed.version='1.0.0.0';$.fn.leverateSocialFeed=function(options){return this.each(function(){(new $.Leverate.SocialFeed(this,options));});};$.Leverate.convertJSONDateToTimeStamp=function(jsonDate){var pattern=/[0-9]+/;var timeStampStr=pattern.exec(jsonDate);var timeStamp=Number(timeStampStr);return timeStamp;},$.Leverate.date_suffix=function(date){if(date==1||date==21||date==31){return'st';}else if(date==2||date==22){return'nd';}else if(date==3||date==23){return'rd';}else{return'th';}};$.Leverate.time_since=function(timeStamp){var original=new Date(timeStamp+(new Date().getTimezoneOffset()*60*1000));var str='';var months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];var chunks=[[31536000000,'year'],[2592000000,'month'],[604800000,'week'],[86400000,'day'],[3600000,'hour'],[60000,'minute'],[1000,'second']];var since=new Date().getTime()-original.getTime();if(since<0){since=60*1000;}if(since>604800000){str=months[original.getMonth()]+' '+original.getDate()+$.Leverate.date_suffix(original.getDate());if(since>31536000000){str=str+', '+original.getFullYear();}return str;}var ms=0;var name=0;var i=0;var ic=chunks.length;var count=0;for(i=0;i<ic;i++){ms=chunks[i][0];name=chunks[i][1];count=Math.floor(since/ms);if(count!=0){break;}}return count+' '+name+((count==1)?'':'s')+' ago';};})(jQuery);$.Leverate.SocialFeedResources={"en-us":{copy:'copy',closed:'closed a',position:'position',price:'at price',gaining:'gaining',placedOrder:'placed an order to'},jp:{copy:'コピー',closed:'クローズA',position:'ポジション',price:'価格で',gaining:'獲得',placedOrder:'に発注した'},fr:{copy:'copier',closed:'a fermé un',position:'position',price:'au cours de',gaining:'avec gain de',placedOrder:'a passé un ordre de'},es:{copy:'copiar',closed:'ha cerrado',position:'posición',price:'a un precio de',gaining:'con una ganancia de',placedOrder:'ha emitido una orden para'},it:{copy:'copia',closed:'ha chiuso una',position:'posizione',price:'al prezzo',gaining:'guadagnando',placedOrder:'ha piazzato un ordine per'},ar:{copy:'نسخ',closed:'تم إغلاق',position:'صفقة',price:'بسعر',gaining:'تكسب',placedOrder:'تم وضع أمر لـ'},sk:{copy:'kopíruj',closed:'uzatvoril',position:'pozíciu',price:'na cene',gaining:'získal',placedOrder:'podal pokyn na'},bg:{copy:'наподобяване',closed:'затворена',position:'позиция',price:'с цена',gaining:'с печалба',placedOrder:'дадена инструкция'},sl:{copy:'posnemaj',closed:'zaprta',position:'položaj',price:'za ceno',gaining:'z dobičkom',placedOrder:'napotek je vnesen'},nl:{copy:'kopieer',closed:'sloot een',position:'positie',price:'tegen de koers',gaining:'en verdiende daarmee',placedOrder:'heeft een order geplaatst'},de:{copy:'kopieren',closed:'geschlossen',position:'position',price:'zum Preis von',gaining:'mit einem Gewinn von',placedOrder:'Order platziert für'},"zh-hans":{copy:'复制',closed:'关闭',position:'位置',price:'价格',gaining:'获得',placedOrder:'下订单'},zh:{copy:'复制',closed:'平仓在',position:'头寸',price:'价格',gaining:'获利',placedOrder:'已经建仓在'},el:{copy:'Αντιγραφή',closed:'Κλείσιμο',position:'Θέσης',price:'Κέρδος',gaining:'Τιμή',placedOrder:'Τοποθέτηση Εντολής'},hu:{copy:'lemásol',closed:'lezárt',position:'pozíciót',price:'árfolyamon',gaining:'nyerő',placedOrder:'megbízást adott le'},nb:{copy:'kopier',closed:'lukket en',position:'posisjon',price:'til pris',gaining:'øker',placedOrder:'plasserer en ordre for'},ru:{copy:'Копировать',closed:'закрыта',position:'позиция',price:'по цене',gaining:'прибыль',placedOrder:'установить приказ'},sr:{copy:'kopiraj',closed:'zatvorio',position:'poziciju',price:'po ceni',gaining:'pri čemu je zaradio',placedOrder:'dao nalog za'},"pt-br":{copy:'copiar',closed:'encerrado a',position:'posição',price:'ao preço',gaining:'ganhos',placedOrder:'efetuou um pedido a'},sv:{copy:'kopiera',closed:'avslutade en',position:'placering',price:'vid pris',gaining:'vinst',placedOrder:'placerade en order till'},ro:{copy:'copiere',closed:'închis la',position:'poziţie',price:'la preţul',gaining:'câştig',placedOrder:'plasarea unui ordin la'},pl:{copy:'naśladuj',closed:'zamknął',position:'pozycja',price:'w cenie',gaining:'zyskiwanie',placedOrder:'złożył zamówienie na'},cs:{copy:'kopie',closed:'zavřel',position:'pozice',price:'za cenu',gaining:'výnos',placedOrder:'zadal objednávku'},tr:{copy:'kopyala',closed:'kapatıldı',position:'pozisyon',price:'şu fiyattan',gaining:'kazanç',placedOrder:'için emir gerçekleştirildi'}};(function($){if(!$.Leverate){$.Leverate=new Object();};$.Leverate.TopPerformers=function(el,options){var self=this;self.$el=$(el);self.el=el;self.noItemsRemoved=false;self.$el.data('Leverate.TopPerformers',self);self.options=$.extend({},$.Leverate.TopPerformers.defaultOptions,options);self.init=function(){self.$el.addClass('top-performers-container').append('<div id="preload-message" class="no-items-to-display"><img alt="" style="vertical-align:-8px;margin-right:5px;" src="'+self.options.socialWidgetClientUrl+'/content/images/website/loader.gif" /> Loading...</div>','<div class="leverate-clearfix frames-tab" style="display:none;"></div>','<div class="leverate-clearfix items-wrapper"></div><div class="leverate-performers-sirix-logo"></div>');if(self.options.tournamentId!=null){self.fetchTournamentItems();}else{self.fetchItems(self.options.defaultPeriod);}}
self.initTimeFrameButtons=function(){var html="";self.$el.find('.frames-tab').show();if(!self.options.showTabs||self.options.tournamentId!=null){self.$el.find('.frames-tab').addClass('no-tabs');}else{var frames=$.Leverate.TopPerformersResources[self.options.language]||$.Leverate.TopPerformersResources['en'];frames=frames.frames;for(var frame in frames){html=$('<div/>').addClass('leverate-fl frame-button').text(frames[frame]);switch(frame){case'oneMonths':html.data('frames',1);break;case'threeMonths':html.data('frames',2);break;case'sixMonths':html.data('frames',3);break;}if(html.data('frames')==self.options.defaultPeriod){html.addClass('selected');}html.bind('click',function(){self.$el.find('.frame-button.selected').removeClass('selected');var itemFrames=$(this).addClass('selected').data('frames');self.fetchItems(itemFrames);});self.$el.find('.frames-tab').append(html);}}}
self.addAllRows=function(allData){if(!self.noItemsRemoved){self.$el.find('.no-items-to-display').remove();self.noItemsRemoved=true;}if(allData.length==0){self.$el.find('.items-wrapper').append('<div>No items to display</div>');return;}var resources=$.Leverate.TopPerformersResources[self.options.language]||$.Leverate.TopPerformersResources['en'];var tableHeaderHtml='<table cellspacing="0" cellpadding="0"><thead><tr>';var tableRowHtml='<tr class="performer-item">';for(var i=0;i<self.options.columnsOrder.length;i++){tableHeaderHtml+=$.Leverate.TopPerformers.uiHeaders[self.options.columnsOrder[i]];tableRowHtml+=$.Leverate.TopPerformers.uiColumns[self.options.columnsOrder[i]];}tableHeaderHtml+='</tr></thead><tbody id="table-rows"></tbody></table>';tableRowHtml+='</tr >';var fakeData={};var tmplHtml=$.tmpl(tableHeaderHtml,fakeData,{resources:resources});tmplHtml.find('.border-right').first().addClass('border-left');self.$el.find('.items-wrapper').append(tmplHtml);for(var j=0;j<allData.length;j++){var rowData=allData[j];var data={};data.name=rowData.Nickname;data.avatar=rowData.Avatar||'';data.flag=rowData.Country||'zz';data.profit=parseFloat(rowData.Profit*100).toFixed(self.options.profitPoint);data.copiers=rowData.Copiers;data.winRate=parseFloat(rowData.WinRatio*100).toFixed(self.options.profitPoint);data.bestPosition=parseFloat(rowData.MaxSingleTradeProfit*100).toFixed(self.options.profitPoint);data.position=j+1;data.days=Math.ceil((new Date()-$.Leverate.TopPerformers.dateTimeReviver(rowData.JoinDate))/86400000);var tableRow=$.tmpl(tableRowHtml,data,{options:self.options,resources:resources});tableRow.find('.button').bind('click',data,function(event){self.options.copyClick(event.data);});self.$el.find('#table-rows').append(tableRow);}}
self.noRows=function(){self.$el.find('.frames-tab').show();self.$el.find('.frames-tab').addClass('no-tabs');self.$el.find('.no-items-to-display').remove();self.noItemsRemoved=true;self.$el.find('.items-wrapper').append('<div class="error">* No items to display</div>');}
self.fetchItems=function(timeFrame){$.ajax({url:self.options.fetchDataUrl+"/UserProfile/GetTopPerformers",cache:false,dataType:'jsonp',jsonp:'jsoncallback',data:{timeFrame:timeFrame,numOfResults:self.options.maxItems},success:function(result){if(self.$el.find('.items-wrapper .performer-item').length>0){self.$el.find('.items-wrapper').empty();}if(result.success){self.addAllRows(result.Data);if(self.$el.find('.frames-tab .frame-button').length==0){self.initTimeFrameButtons();}}else{self.noRows();}}});}
self.fetchTournamentItems=function(){$.ajax({url:self.options.fetchDataUrl+"/UserProfile/GetTournamentTopPerformers",cache:false,dataType:'jsonp',jsonp:'jsoncallback',data:{tournamentId:self.options.tournamentId,numOfResults:self.options.maxItems},success:function(result){if(self.$el.find('.items-wrapper .performer-item').length>0){self.$el.find('.items-wrapper').empty();}if(result.success){self.addAllRows(result.Data);if(self.$el.find('.frames-tab .frame-button').length==0){self.initTimeFrameButtons();}}else{self.noRows();}}});}
self.init();};$.Leverate.TopPerformers.uiColumns={};$.Leverate.TopPerformers.uiColumns["position"]='<td><div class="position">${position}.</div></td>';$.Leverate.TopPerformers.uiColumns["avatar"]='<td><div class="leverate-pr avatar"><img alt="" src="${$item.options.socialWidgetClientUrl}/Avatars/GetAvatar/?imageQuary=${avatar}" /><div class="leverate-pa flag"><img alt="" src="${$item.options.socialWidgetClientUrl}/Flags/GetFlag/?countryCode=${flag}.png" /></div></div></td>';$.Leverate.TopPerformers.uiColumns["nickname"]='<td><div class="user-name">${name}</div></td>';$.Leverate.TopPerformers.uiColumns["bestPosition"]='<td><div class="bestPosition">${bestPosition}%</div></td>';$.Leverate.TopPerformers.uiColumns["copyButton"]='<td><div class="button copy">${$item.resources["copy"]}</div></td>';$.Leverate.TopPerformers.uiColumns["days"]='<td><div class="days">${days}</div></td>';$.Leverate.TopPerformers.uiColumns["winRate"]='<td><div class="win-rate">${winRate}%</div></td>';$.Leverate.TopPerformers.uiColumns["copiers"]='<td><div class="copiers">${copiers}</div></td>';$.Leverate.TopPerformers.uiColumns["profit"]='<td><div class="profit"><div class="profit">${profit}%</div></div></td>';$.Leverate.TopPerformers.uiHeaders={};$.Leverate.TopPerformers.uiHeaders["position"]='<th class="position-header"></th>';$.Leverate.TopPerformers.uiHeaders["avatar"]='<th class="avatar-header"></th>';$.Leverate.TopPerformers.uiHeaders["nickname"]='<th class="nickname-header"></th>';$.Leverate.TopPerformers.uiHeaders["bestPosition"]='<th class="bestPosition-header border-right">${$item.resources["bestPosition"]}</th>';$.Leverate.TopPerformers.uiHeaders["copyButton"]='<th class="copyButton-header"></th>';$.Leverate.TopPerformers.uiHeaders["days"]='<th class="days-header border-right">${$item.resources["days"]}</th>';$.Leverate.TopPerformers.uiHeaders["winRate"]='<th class="winRate-header border-right">${$item.resources["winRate"]}</th>';$.Leverate.TopPerformers.uiHeaders["copiers"]='<th class="copiers-header border-right">${$item.resources["copiers"]}</th>';$.Leverate.TopPerformers.uiHeaders["profit"]='<th class="profit-header border-right">${$item.resources["profit"]}</th>';$.Leverate.TopPerformers.dateTimeReviver=function(value){var a;if(typeof value==='string'){a=/\/Date\((\d*)\)\//.exec(value);if(a){return new Date(+a[1]);}}return value;}
$.Leverate.TopPerformers.defaultOptions={socialWidgetClientUrl:'',fetchDataUrl:'http://qaserver.webtrader.leverate.com:9442',maxItems:10,profitPoint:1,language:'en',copyClick:function(item){},tournamentId:null,showTabs:true,columnsOrder:["position","avatar","nickname","profit","copyButton"],defaultPeriod:1};$.Leverate.TopPerformers.version='1.0.0.0';$.fn.leverateTopPerformers=function(options){return this.each(function(){(new $.Leverate.TopPerformers(this,options));});}})(jQuery);$.Leverate.TopPerformersResources={en:{days:'Days in social',winRate:'Success rate',copiers:'Copiers',profit:'Profit',bestPosition:'Best position',copy:'Copy',frames:{oneMonths:'1 Month',threeMonths:'3 Months',sixMonths:'6 Months'}},jp:{days:'Days in social',winRate:'Success rate',copiers:'Copiers',profit:'Profit',bestPosition:'Best position',copy:'コピー',frames:{oneMonths:'1ヶ月',threeMonths:'3ヶ月間',sixMonths:'6ヶ月'}},fr:{days:'Days in social',winRate:'Success rate',copiers:'Copiers',profit:'Profit',bestPosition:'Best position',copy:'Copier',frames:{oneMonths:'1 Mois',threeMonths:'3 Mois',sixMonths:'6 Mois'}}};(function($){if(!$.Leverate){$.Leverate=new Object();}$.Leverate.FeaturedUser=function(el,options){var self=this;self.$el=$(el);self.el=el;self.$el.data('Leverate.FeaturedUser',self);var ranks={0:'Champion',1:'Grand Master',2:'Master',3:'Expert',4:'Trader'};self.init=function(){self.options=$.extend({},$.Leverate.FeaturedUser.defaultOptions,options);self.$el.addClass('profile-cube-container').append('<div class="leverate-featureduser-sirix-logo"></div>');self.fetchItem();}
self.fetchItem=function(){$.ajax({url:self.options.fetchDataUrl+'/UserProfile/GetRandomTopPerformer',cache:false,dataType:'jsonp',jsonp:'jsoncallback',success:function(result){var data={};data.avatar=result.Data.Avatar?result.Data.Avatar:"defaultAvatar1";data.flag=result.Data.Country||'zz';data.name=result.Data.Nickname;data.risk=parseFloat(result.Data.RiskLevel).toFixed(2);;data.pl=parseFloat(result.Data.Profit*100).toFixed(2);data.pl=data.pl>500?'>500':data.pl;data.rank=result.Data.ProficiencyLevel;data.rankAsString=self.rankToString(data.rank);data.rankImage=data.rankAsString.replace(' ','');var resources=$.Leverate.FeaturedUserResources[self.options.language]||$.Leverate.FeaturedUserResources['en'];var html=$.tmpl(self.options.tpl,data,{options:self.options,resources:resources});if(html){self.$el.append(html);}}});}
self.rankToString=function(rank){return ranks[rank];}
self.init();}
$.Leverate.FeaturedUser.defaultOptions={socialWidgetClientUrl:'',fetchDataUrl:'http://qaserver.webtrader.leverate.com:9442',language:'en',tpl:['<div class="cube-title">','<div class="text">${$item.resources["title"]}</div>','</div>','<div class="badge"><img alt="" src="${$item.options.socialWidgetClientUrl}/Badges/GetBadge/?badgeQuery=${rankImage}" /></div>','<div class="leverate-clearfix personal">','<div class="leverate-fl left">','<div class="leverate-center image">','<img alt="" src="${$item.options.socialWidgetClientUrl}/Avatars/GetAvatar/?imageQuary=${avatar}" />','<div class="flag"><img alt="" src="${$item.options.socialWidgetClientUrl}/Flags/GetFlag/?countryCode=${flag}" /></div>','</div>','</div>','<div class="leverate-fl right">','<div class="user-name">${name}</div>','<div class="leverate-clearfix rank">','<div class="leverate-fl icon"><img alt="" src="${$item.options.socialWidgetClientUrl}/Content/Images/Badges/medal.gif" /></div>','<div class="leverate-fl text">${rankAsString}</div>','</div>','</div>','</div>','<div class="user-data">','<div class="leverate-clearfix data-row">','<div class="leverate-fl key"><span>${$item.resources["keys"]["pl"]}</span></div>','<div class="leverate-fl value positive"><span>${pl}%</span></div>','</div>','<div class="leverate-clearfix data-row">','<div class="leverate-fl key"><span>${$item.resources["keys"]["risk"]}</span></div>','<div class="leverate-fl value"><span>${risk} / 10</span></div>','</div>','</div>'].join("")};$.Leverate.FeaturedUser.version='1.0.0.0';$.fn.leverateFeaturedUser=function(options){return this.each(function(){(new $.Leverate.FeaturedUser(this,options));});}})(jQuery);$.Leverate.FeaturedUserResources={en:{title:'spotlight',keys:{pl:'P/L (%)',risk:'Risk',joined:'Joined'}},jp:{title:'スポットライト',keys:{pl:'損益 (%)',risk:'リスク',joined:'参加しました'}},fr:{title:'spotlight',keys:{pl:'P/L (%)',risk:'Risk',joined:'Joined'}}};var EngineType={Poll:1,Push:2};function PollRatesEngine(obj){this.interval=null;this.intervalTime=obj.intervalTime*1000;this.intervalTime=this.intervalTime<(5*1000)?(5*1000):this.intervalTime;this.lastServerTime=0;this.fetchDataUrl=obj.fetchDataUrl||'http://localhost:51525';this.instruments=obj.instruments?obj.instruments.join(','):'';this.lock=false;return this;}PollRatesEngine.prototype.start=function(callback){var self=this;this.lastServerTime=0;this.requestData(callback||function(){});self.interval=window.setInterval(function(){self.requestData(callback);},self.intervalTime);return this;}
PollRatesEngine.prototype.stop=function(){if(this.interval){window.clearInterval(this.interval);this.interval=null;}return this;}
PollRatesEngine.prototype.requestData=function(callback){var self=this;if(!self.lock&&self.instruments){self.lock=true;$.ajax({url:self.fetchDataUrl+'/MarketRates/GetData',cache:false,dataType:'jsonp',jsonp:'jsoncallback',data:{crosses:self.instruments,lastServerTime:self.lastServerTime},success:function(result){self.lock=false;self.lastServerTime=result.Data.ServerTime;if(callback){callback.call(result);}}});}return this;}
PollRatesEngine.prototype.setInstruments=function(instruments){if(instruments&&typeof instruments==='object'){this.instruments=instruments.join(',');}return this;}
function PushRatesEngine(obj){this.fetchDataUrl=obj.fetchDataUrl||'http://localhost:51525';this.instruments=obj.instruments?obj.instruments.join(','):'';this.lock=false;this.started=false;$.connection.hub.url=this.fetchDataUrl+'/signalr';this.marketRatesHub=$.connection.marketRatesHub;return this;}PushRatesEngine.prototype.start=function(callback){var self=this;self.marketRatesHub.update=function(obj){if(callback&&obj){callback.call(obj);}}
$.connection.hub.start({xdomain:true,transport:['longPolling','webSockets']}).done(function(){self.started=true;self.marketRatesHub.addToGroups(self.instruments).done(function(){});});return this;}
PushRatesEngine.prototype.stop=function(){if(this.started){this.marketRatesHub.removeFromGroups(this.instruments).done(function(){});}return this;}
PushRatesEngine.prototype.setInstruments=function(instruments){if(instruments&&typeof instruments==='object'){this.instruments=instruments.join(',');}return this;}
if(!$.Leverate){$.Leverate=new Object();};(function($){if(!$.Leverate){$.Leverate=new Object();};$.Leverate.MarketRatesGrid=function(el,options){var self=this;self.$el=$(el);self.el=el;self.$el.data('Leverate.MarketRatesGrid',self);self.engine=null;self.selectedTab='';self.init=function(){self.options=$.extend({},$.Leverate.MarketRatesGrid.defaultOptions,options);self.initSpread=function(){if(self.options.showSpread){self.$el.addClass('leverate-rates-grid-container leverate-rates-grid-withspeard').append('<div class="leverate-ratesgrid-sirix-logo"></div>');self.options.tpl=['<div class="leverate-clearfix leverate-table-row">','<div class="leverate-fl leverate-row-item leverate-item-instrument"><img alt="" src="${$item.options.socialWidgetClientUrl}/InstrumentsImage/GetImage/?instrumentName=${instrument}" /></div>','<div class="leverate-fl leverate-row-item leverate-item-symbol">${symbol}</div>','<div class="leverate-fl leverate-row-item leverate-item-arrow leverate-arrow-${arrow}"></div>','<div class="leverate-fl leverate-row-item leverate-item-bid">{{html bid}}</div>','<div class="leverate-fl leverate-row-item leverate-item-ask">{{html ask}}</div>','<div class="leverate-fl leverate-row-item leverate-item-spread">{{html spread}}</div>','</div>'].join('');}else{self.$el.addClass('leverate-rates-grid-container').append('<div class="leverate-ratesgrid-sirix-logo"></div>');}};self.initSpread();self.$el.addClass('leverate-rates-grid-container').append('<div class="leverate-ratesgrid-sirix-logo"></div>');self.$el.append('<div class="leverate-clearfix leverate-rates-tabs"></div>','<div class="leverate-clearfix leverate-grid-header">'+'<div class="leverate-fl leverate-header-item leverate-item-symbol">Symbol</div>'+'<div class="leverate-fl leverate-header-item leverate-item-bid">Bid</div>'+'<div class="leverate-fl leverate-header-item leverate-item-ask">Ask</div>'+(self.options.showSpread?'<div class="leverate-fl leverate-header-item leverate-item-spread">Spread</div>':'')+'</div><div class="leverate-clearfix leverate-rates-grids"></div>');switch(self.options.engine){case EngineType.Poll:self.engine=new PollRatesEngine({intervalTime:self.options.updateInterval,fetchDataUrl:self.options.fetchDataUrl});break;case EngineType.Push:self.engine=new PushRatesEngine({fetchDataUrl:self.options.fetchDataUrl});break;}self.initTabs();}
self.changeTab=function(group){if(self.options.groups[group]){if(self.engine){self.engine.stop();}$('.leverate-rates-tab.leverate-tab-selected').removeClass('leverate-tab-selected');$('.leverate-rates-tab.'+group+'-tab').addClass('leverate-tab-selected');$('.leverate-grid-table.leverate-table-selected').removeClass('leverate-table-selected');$('.leverate-grid-table.'+group+'-table').addClass('leverate-table-selected');self.selectedTab=group;self.engine.setInstruments(self.groupToCrossesArray(self.options.groups[group]));self.engine.start(function(){self.fetchGroupData(this);});}}
self.groupToCrossesArray=function(groupData){var result=[];for(var i=0,len=groupData.length;i<len;i++){if(typeof groupData[i]==='string'){result.push(groupData[i]);}else if(typeof groupData[i]==='object'&&groupData[i].name){result.push(groupData[i].name);}}return result;}
self.calcSpread=function(ask,bid,pipDigit){return Math.pow(10,pipDigit)*(ask-bid);}
self.fetchGroupData=function(data){var $table=$('.leverate-grid-table.leverate-table-selected');if(data.Data){var ratesMap={};var rateNameMatch;var currentRates=this.options.groups[this.selectedTab];for(var i=0,total=data.Data.Rates.length;i<total;i++){var dataRateName=data.Data.Rates[i].Name;for(var j=0,len=currentRates.length;j<len;j++){if(typeof currentRates[j]=='object')rateNameMatch=currentRates[j].name;else
rateNameMatch=currentRates[j];if(new RegExp(rateNameMatch).test(dataRateName)){ratesMap[dataRateName]=data.Data.Rates[i];break;}}}for(var rateNameKey in ratesMap){var $row=$table.find('.leverate-table-row:contains("'+rateNameKey+'")');var precision=self.getPrecision(rateNameKey);if($row.length>0){self.updateTableRow($row,ratesMap[rateNameKey],precision);}else{self.addTableRow($table,ratesMap[rateNameKey],precision);}}}else{var $row=$table.find('.leverate-table-row:contains("'+data.Name+'")');var precision=self.getPrecision(data.Name);if($row.length>0){self.updateTableRow($row,data,precision);}else{self.addTableRow($table,data,precision);}}}
self.getPrecision=function(name){var result=0;var len=self.options.groups[self.selectedTab].length;for(var i=0;i<len;i++){if(typeof self.options.groups[self.selectedTab][i]==='object'&&self.options.groups[self.selectedTab][i].name==name){result=self.options.groups[self.selectedTab][i].precision;break;}}return result;}
self.updateTableRow=function(row,data,precision){var html='',tpldata={};tpldata.instrument=data.Name;tpldata.symbol=data.Name;tpldata.arrow=parseFloat(data.Bid)-parseFloat(row.find('.leverate-item-bid').text())>=0?'up':'down';tpldata.bid=data.Bid.toFixedHtml(precision);tpldata.ask=data.Ask.toFixedHtml(precision);tpldata.spread=self.calcSpread(data.Ask,data.Bid,precision);html=$.tmpl(self.options.tpl,tpldata,{options:self.options});row.replaceWith(html);}
self.addTableRow=function(table,data,precision){var html='',tpldata={};tpldata.instrument=data.Name;tpldata.symbol=data.Name;tpldata.arrow='up';tpldata.bid=data.Bid.toFixedHtml(precision);tpldata.ask=data.Ask.toFixedHtml(precision);tpldata.spread=self.calcSpread(data.Ask,data.Bid,precision);html=$.tmpl(self.options.tpl,tpldata,{options:self.options});if(html){table.append(html);}}
self.initTabs=function(){for(var group in self.options.groups){if(!self.selectedTab){self.selectedTab=group;}var tabHtml=$('<div class="leverate-fl leverate-rates-tab '+group+'-tab"></div>').text(group);tabHtml.data('group-name',group);var tableHtml=$('<div class="leverate-grid-table '+group+'-table"></div>');self.$el.find('.leverate-rates-tabs').append(tabHtml);self.$el.find('.leverate-rates-grids').append(tableHtml);}$('.leverate-rates-tab').live('click',function(){var group=$(this).data('group-name');self.changeTab(group);});self.changeTab(self.selectedTab);}
Number.prototype.toFixedHtml=function(precision){var self=this;if(precision){self=self.toFixed(precision);}self=self.toString();var pointIdx=self.indexOf('.');if(pointIdx>-1){pointIdx+=1;var delta=self.length-pointIdx;if(delta%2==0){self=self.substring(0,self.length-2)+'<span style="font-size:1.167em;font-weight:bold;">'+self.substring(self.length-2,self.length)+'</span>';}else{self=self.substring(0,self.length-3)+'<span style="font-size:1.167em;font-weight:bold;">'+self.substring(self.length-3,self.length-1)+'</span><span style="font-size:0.833em;">'+self.substring(self.length-1,self.length)+'</span>'}}return self;}
self.init();};$.Leverate.MarketRatesGrid.defaultOptions={socialWidgetClientUrl:'',fetchDataUrl:'https://webrates.forexwebservices.com',engine:EngineType.Poll,updateInterval:5,showSpread:false,groups:{Forex:[{name:'EURUSD',precision:3},'EURGBP','GBPUSD'],Commodities:['WTI','Gold','Silver','Suger','Oil',],Indices:['NSDQ','FTSE','CAC','DOW','SP500','DAX'],Stocks:['APPLE','GOOGLE','INTEL','YAHOO','MSFT','IBM']},language:'en',tpl:['<div class="leverate-clearfix leverate-table-row">','<div class="leverate-fl leverate-row-item leverate-item-instrument"><img alt="" src="${$item.options.socialWidgetClientUrl}/InstrumentsImage/GetImage/?instrumentName=${instrument}" /></div>','<div class="leverate-fl leverate-row-item leverate-item-symbol">${symbol}</div>','<div class="leverate-fl leverate-row-item leverate-item-arrow leverate-arrow-${arrow}"></div>','<div class="leverate-fl leverate-row-item leverate-item-bid">{{html bid}}</div>','<div class="leverate-fl leverate-row-item leverate-item-ask">{{html ask}}</div>','</div>'].join('')};$.Leverate.MarketRatesGrid.version='1.0.0.0';$.fn.leverateMarketRatesGrid=function(options){return this.each(function(){(new $.Leverate.MarketRatesGrid(this,options));});}})(jQuery);$.Leverate.MarketRatesGridResources={en:{},fn:{}};if(!$.Leverate){$.Leverate=new Object();};(function($){if(!$.Leverate){$.Leverate=new Object();};$.Leverate.MarketRatesTicker=function(el,options){var self=this;self.$el=$(el);self.el=el;self.$el.data('Leverate.MarketRatesTicker',self);self.engine=null;self.animationStarted=false;self.init=function(){self.options=$.extend({},$.Leverate.MarketRatesTicker.defaultOptions,options);self.$el.addClass('leverate-rates-ticker-container leverate-ticker-'+self.options.skin).append('<div class="sirix-ticker-logo-wrapper"><div class="sirix-ticker-logo"></div></div>');self.$el.append('<div class="leverate-rates-animated-row leverate-clearfix"></div>');switch(self.options.engine){case EngineType.Poll:self.engine=new PollRatesEngine({intervalTime:self.options.updateInterval,fetchDataUrl:self.options.fetchDataUrl});break;case EngineType.Push:self.engine=new PushRatesEngine({fetchDataUrl:self.options.fetchDataUrl});break;}self.startEngine();}
self.startEngine=function(){self.engine.setInstruments(self.instrumentsToCrossesArray(self.options.instruments));self.engine.start(function(){self.fetchTickerData(this);});}
self.instrumentsToCrossesArray=function(){var result=[];for(var i=0,len=self.options.instruments.length;i<len;i++){if(typeof self.options.instruments[i]==='string'){result.push(self.options.instruments[i]);}else if(typeof self.options.instruments[i]==='object'&&self.options.instruments[i].name){result.push(self.options.instruments[i].name);}}return result;}
self.fetchTickerData=function(data){var $animatedRow=self.$el.find('.leverate-rates-animated-row');if(data.Data){for(var i=0,len=data.Data.Rates.length;i<len;i++){var $item=$animatedRow.find('.leverate-rates-item:contains("'+data.Data.Rates[i].Name+'")');var precision=self.getPrecision(data.Data.Rates[i].Name);if($item.length>0){self.updateTickerItem($item,data.Data.Rates[i],precision);}else{self.addTickerItem($animatedRow,data.Data.Rates[i],precision);}}}else{var $item=$animatedRow.find('.leverate-rates-item:contains("'+data.Name+'")');var precision=self.getPrecision(data.Name);if($item.length>0){self.updateTickerItem($item,data,precision);}else{self.addTickerItem($animatedRow,data,precision);}}}
self.getPrecision=function(name){var result=0;var len=self.options.instruments.length;for(var i=0;i<len;i++){if(typeof self.options.instruments[i]==='object'&&self.options.instruments[i].name==name){result=self.options.instruments[i].precision;break;}}return result;}
self.updateTickerItem=function(item,data,precision){var html='',tpldata={};tpldata.arrow=parseFloat(data.Bid)-parseFloat(item.find('.leverate-item-bid').text())>=0?'leverate-arrow-up':'leverate-arrow-down';tpldata.bid=data.Bid.toFixedHtml(precision);tpldata.ask=data.Ask.toFixedHtml(precision);item.find('.leverate-item-arrow').removeClass('leverate-arrow-up').removeClass('leverate-arrow-down').addClass(tpldata.arrow);item.find('.leverate-item-bid').html(tpldata.bid);item.find('.leverate-item-ask').html(tpldata.ask);}
self.addTickerItem=function(animatedRow,data,precision){var html='',tpldata={};tpldata.arrow='up'
tpldata.symbol=data.Name;tpldata.bid=data.Bid.toFixedHtml(precision);tpldata.ask=data.Ask.toFixedHtml(precision);html=$.tmpl(self.options.tpl,tpldata,{options:self.options});if(html){var w=parseInt(animatedRow.css('width'))+270;animatedRow.css('width',w+'px');animatedRow.append(html);var cw=parseInt(self.$el.css('width'));if(!self.animationStarted&&cw<w){self.animationStarted=true;self.startAnimation();}}}
self.startAnimation=function(){var $firstItem=$(self.$el.find('.leverate-rates-animated-row .leverate-rates-item')[0]);var $animatedRow=self.$el.find('.leverate-rates-animated-row');$firstItem.animate({'margin-left':'-270px'},self.options.speed,'linear',function(){$(this).remove();$firstItem.css('margin-left','');$animatedRow.append($firstItem);self.startAnimation();});}
Number.prototype.toFixedHtml=function(precision){var self=this;if(precision){self=self.toFixed(precision);}self=self.toString();var pointIdx=self.indexOf('.');if(pointIdx>-1){pointIdx+=1;var delta=self.length-pointIdx;if(delta%2==0){self=self.substring(0,self.length-2)+'<span style="font-size:1.167em;font-weight:bold;">'+self.substring(self.length-2,self.length)+'</span>';}else{self=self.substring(0,self.length-3)+'<span style="font-size:1.167em;font-weight:bold;">'+self.substring(self.length-3,self.length-1)+'</span><span style="font-size:0.833em;">'+self.substring(self.length-1,self.length)+'</span>'}}return self;}
self.init();};$.Leverate.MarketRatesTicker.defaultOptions={socialWidgetClientUrl:'',fetchDataUrl:'https://webrates.forexwebservices.com',engine:EngineType.Poll,updateInterval:5,speed:5000,skin:'dark',instruments:[{name:'EURUSD',precision:3},'EURGBP','GBPUSD',{name:'EURCHF',precision:5},'USDCHF','GBPCHF','NZDJPY','AUDNZD','AUDCAD','CADJPY','CHFJPY','CADCHF'],tpl:['<div class="leverate-rates-item">','<div class="leverate-item-symbol-icon"><img alt="" src="${$item.options.socialWidgetClientUrl}/InstrumentsImage/GetImage/?instrumentName=${symbol}" /></div>','<div class="leverate-item-arrow leverate-arrow-${arrow}"></div>','<div class="leverate-item-symbol">${symbol}</div>','<div class="leverate-item-rate"><span class="leverate-item-bid">{{html bid}}</span> / <span class="leverate-item-ask">{{html ask}}</span></div>','</div>'].join('')};$.Leverate.MarketRatesTicker.version='1.0.0.0';$.fn.leverateMarketRatesTicker=function(options){return this.each(function(){(new $.Leverate.MarketRatesTicker(this,options));});}})(jQuery);window.onLeverateWidgetsLoad();